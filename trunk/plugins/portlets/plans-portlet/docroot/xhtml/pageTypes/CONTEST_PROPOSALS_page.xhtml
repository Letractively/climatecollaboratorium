<?xml version="1.0"?>
<f:view

        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:collab="http://climatecollaboratorium.org/facelets">

<ui:composition template="../templates/contestPageTemplateWithButtons.xhtml">

<ui:define name="plans_breadcrumb">
    <collab:contestsPageLink text="Contests Index" /> &amp;gt;&amp;gt; &amp;nbsp;  
    <strong><ice:outputText>#{contest.contest.shortName}</ice:outputText></strong>
</ui:define>

<ui:define name="contest_content">
<ice:form>
    <ui:include src="../createPlan.xhtml">
        <ui:param value="#{navigation.createPlanBean}" name="createPlanBean"/>
    </ui:include>
</ice:form>

<div class="contestPhaseInfo">
    <div class="details">
        <f:subview rendered="#{plansIndex.contestPhase.status != 'FINISHED'}">
            <h3>#{plansIndex.contestPhase.description}
                (#{plansIndex.plansCount} proposals #{plansIndex.contestPhase.status == 'OPEN_FOR_SUBMISSION' ? 'thus far' : ''})
            </h3>
            <h4>#{plansIndex.contestPhase.name} closes &amp;nbsp;
                <ice:outputText value="#{plansIndex.contestPhase.endDate}">
                    <f:convertDateTime pattern="MMMMM d"/>
                </ice:outputText>
            </h4>
        </f:subview>

        <f:subview rendered="#{plansIndex.contestPhase.status == 'FINISHED'}">
            <h3>Contest completed &amp;nbsp;
                <ice:outputText value="#{plansIndex.contestPhase.endDate}">
                    <f:convertDateTime pattern="MMMMM d, yyyy"/>
                </ice:outputText>
                (#{plansIndex.plansCount} final proposals)
            </h3>
        </f:subview>
    </div>
    <f:subview rendered="#{plansIndex.contestPhase.status == 'OPEN_FOR_SUBMISSION'}">
        <ice:form>
            <ice:commandButton onclick="if(!deferUntilLogin()) return false; Collab.nav.block();"
                               styleClass="prominantButton createNewPlanButton"
                               actionListener="#{navigation.createPlanBean.createPlan}"
                               value="Begin a new proposal"/>
        </ice:form>
    </f:subview>

    <div class="clear"></div>
</div>


<div class="proposalsListNav">
    <f:subview rendered="#{not contest.currentPhase.firstPhase}">
        <a href="#plans=contests:#{contest.contest.contestActive ? 'active' : 'past'},subview:proposals,viewProposals:active"
           class="#{plansIndex.showPreviousProposals ? '' : 'active'}">
            <ice:outputText value="Active Proposals" rendered="#{plansIndex.contestPhase.status != 'FINISHED'}"/>
            <ice:outputText value="Final Proposals" rendered="#{plansIndex.contestPhase.status == 'FINISHED'}"/>
        </a>
        <a href="#plans=contests:#{contest.contest.contestActive ? 'active' : 'past'},subview:proposals,viewProposals:previous"
           class="#{plansIndex.showPreviousProposals ? 'active' : ''}">
            <ice:outputText value="Previous Proposals" rendered="#{plansIndex.contestPhase.status != 'FINISHED'}"/>
            <ice:outputText value="Other Proposals" rendered="#{plansIndex.contestPhase.status == 'FINISHED'}"/>
        </a>
    </f:subview>

    <div class="filters">
        <ice:form>
            <h3>Viewing:</h3>
            <ice:selectOneMenu value="#{plansIndex.selectedMode}" partialSubmit="true">
                <f:selectItems value="#{plansIndex.availableModes}"/>
            </ice:selectOneMenu>
        </ice:form>
    </div>


    <div class="clear"></div>

</div>
    <ice:form>
    <ui:decorate template="../templates/plansList.xhtml">
        <ui:param name="maxRows" value="#{plansIndex.pageSize}" />
        <ui:param name="renderPaginator" value="false" />
    </ui:decorate>
    </ice:form>


</ui:define>
</ui:composition>
</f:view>
