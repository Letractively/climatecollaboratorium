<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:collab="http://climatecollaboratorium.org/facelets"
        xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:collabcomps="http://climatecollaboratorium.org/components">


    <ice:panelGroup styleClass="hidden">
        <script type="text/javascript">
            Collab.nav.addEditorDirtyValidationCallback(checkIfActionsImpactsDirty);
        </script>
    </ice:panelGroup>

    <div class="versionsContainer">
        <div class="versions">
            <ice:dataTable value="#{planBean.plan.planModelRunVersionItems}" rows="10" var="historyItem">
                <ice:column>
                    <f:facet name="header">
                        <ice:outputText value="Date"/>
                    </f:facet>
                    <ice:commandLink value="#{historyItem.updateDate}"
                                     actionListener="#{planBean.plan.selectModelRunVersion}">
                        <f:attribute name="item" value="#{historyItem}"/>
                    </ice:commandLink>


                </ice:column>
                <ice:column>
                    <f:facet name="header">
                        <ice:outputText value="User"/>
                    </f:facet>
                    <ice:outputText value="#{historyItem.updateAuthor.screenName}"/>


                </ice:column>
            </ice:dataTable>
            <br/>

        </div>
    </div>
    <ice:panelGrid styleClass="toolbar" columns="3">
    <ice:panelGroup styleClass="edit editControls"
                    rendered="#{planBean.plan.selectedModel != null and permissions.canEdit and not simulationBean.embeddedEditing}">
        <ice:commandLink styleClass="editButton" value="Edit" actionListener="#{simulationBean.editActions}"
                />
    </ice:panelGroup>
    <ice:panelGroup styleClass="save editControls" rendered="#{simulationBean.embeddedEditing}">
        <ice:commandLink value="Save Changes" actionListener="#{simulationBean.saveScenario}"/>
    </ice:panelGroup>
    <ice:panelGroup styleClass="cancelEdit editControls" rendered="#{simulationBean.embeddedEditing}">
        <ice:commandLink value="Cancel" actionListener="#{simulationBean.editActions}"/>
    </ice:panelGroup>


    <ice:panelGroup styleClass="chooseVersionWidget">
        <a href="javascript:" class="versionsTrigger">Show old versions</a>
    </ice:panelGroup>
    </ice:panelGrid>


    <div class="clear"></div>


    <collabcomps:helpMessage messageId="planModelRunHelp" styleClass="planHelp" hideThisMessage="Hide this message">
        The actions in a plan become inputs to simulation models. The models then project the impacts of those actions, which can include:
    </collabcomps:helpMessage>
    <collabcomps:helpMessageTrigger messageId="planModelRunHelp">+show help</collabcomps:helpMessageTrigger>

    <ice:panelGroup styleClass="actionsImpactsContainer">
        <ice:panelGroup styleClass="versionInfo" rendered="#{not planBean.plan.simulationLatestVersion}">
            Viewing version from &amp;nbsp; <strong><ice:outputText
                value="#{planBean.plan.simulationVersionDate}"/></strong> by &amp;nbsp;
            <a href="/web/guest/members?userId=#{planBean.plan.simulationVersionAuthor.userId}">
                <strong><ice:outputText value="#{planBean.plan.simulationVersionAuthor.screenName}"/></strong>
            </a>
        </ice:panelGroup>

        <ice:panelGroup styleClass="inputsAndOutputsWidget" rendered="#{planBean.plan.selectedModel != null}">
            <f:subview rendered="#{permissions.canEdit}">
                <collab:simulation simulationId="#{planBean.plan.selectedModel}"
                                   scenarioId="#{planBean.plan.planModelRunScenarioId}"
                                   showEditArea="true" showEditButton="false"/>
            </f:subview>
            <f:subview rendered="#{not permissions.canEdit}">
                <collab:simulation simulationId="#{planBean.plan.selectedModel}"
                                   scenarioId="#{planBean.plan.planModelRunScenarioId}"
                                   disableInputs="true"/>
            </f:subview>
        </ice:panelGroup>

        <ice:panelGroup styleClass="inputsAndOutputsWidget" rendered="#{planBean.plan.selectedModel == null}">
            No model has been set.
        </ice:panelGroup>
    </ice:panelGroup>
    <script language="javascript">
        jQuery(document).ready(initVersionChoosingBox);
    </script>
</f:view>
