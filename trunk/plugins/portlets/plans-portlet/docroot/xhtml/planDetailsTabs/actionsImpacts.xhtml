<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:liferay-faces="http://liferay.com/tld/faces">
    <ice:panelGroup styleClass="editWithVersions actionsImpactsEditContainer" rendered="#{planBean.simulationBean.editing}">
        <div class="chooseVersionWidget">
            <input type="button" value="Versions" class="versionsTrigger expand" />
                <div class="versionsContainer relative">
                    <div class="versions">
                        <ice:selectOneListbox value="#{planBean.plan.currentPlanModelRunVersion}" partialSubmit="true">
                            <f:selectItems value="#{planBean.plan.planModelRunVersionItems}" /> 
                        </ice:selectOneListbox>
                        <br />
                        <input type="button" value="Hide" class="versionsTrigger collapse" />
                    </div>
                    
                    <ice:panelGroup>
                        <script language="javascript">
                            switchToScenario(#{planBean.plan.planModelRunScenarioId});
                        </script>
                    </ice:panelGroup>
                    <div class="clear"></div>    
            </div>
        </div>
    </ice:panelGroup>
<script type="text/javascript">

    // currently there is no dynamic association between plan and a scenario/model,
    // static reference used, please refer to requirements doc
    

    function portletModelImpactsInnerPortlet() {
        jQuery("#loadingNotification").hide();
        // update iframe height to wrap entire document, this prevents from displaying additional scrollbar
        var frame = document.getElementById("actionsAndImpacts");
        var frameContent =  (frame.contentDocument) ? frame.contentDocument : frame.contentWindow.document;
        jQuery(frame).attr("scrolling", "no");
        var contentDocument = jQuery(frameContent);
              
        
        frame.height = frameContent.body.scrollHeight;
        //jQuery(frame).css("overflow", "hidden");
        jQuery(frame).css("border", "0");
        jQuery(frame).css("overflow", "hidden");
        
        jQuery("#portlet-model-impacts").load(portletModelImpactsInnerPortlet);
        frame.contentWindow.jQuery.history.init(function() {});

        //alert("should show..." + jQuery("#plans-model-impacts-container").length);
        
        jQuery("#plans-model-impacts-container").css("left", "0").css("position", "normal");

        frameContent.saveScenarioFunction = function(scenarioId) {
            jQuery(".scenarioInput").val(scenarioId);
            jQuery(".scenarioUpdateButton").click();
        }

        frameContent.cancelEditingFunction = function(scenarioId) {
            jQuery(".scenarioCancelEditingButton").click();
        }

        frameContent.updateFrameHeight = function() {
            frame.height = frameContent.body.scrollHeight + 40;
            jQuery(frameContent).scrollTop(0);
            frame.scrollTop(0);
        }
    }

    
    /**
    Function responsible for attaching portletPlansModifyInnerPortlet to iframe's onload event 
    */ 
    jQuery(document).ready(function() {
        var frame = jQuery("#actionsAndImpacts").load(portletModelImpactsInnerPortlet);
    });
    
</script>
    <div style="width: 100%; height: 50px; text-align: center" id="loadingNotification">
        <img src="/collaboratorium-theme/images/ajax-loader.gif" style="margin-top: 50px"/>
    </div>
    <iframe id="actionsAndImpacts"  border="0" frameborder="0" marginheight="0" marginwidth="0" scrolling="no" style="border: 0; width: 100%; overflow: hidden; overflow-x: hidden; overflow-y: hidden;" src="/widget/web/guest/models/-/models_WAR_modelsportlet_INSTANCE_28Id?modelId=#{planBean.plan.planType.modelId}&amp;viewType=embedded&amp;page=actions&amp;canEdit=#{planBean.simulationBean.editing}&amp;scenarioId=#{planBean.plan.scenarioId}" />
    
    <ice:inputText value="#{planBean.simulationBean.scenario}" styleClass="scenarioInput" style="display: none" />
    <ice:commandButton actionListener="#{planBean.simulationBean.update}" style="display: none" styleClass="scenarioUpdateButton" />
    <ice:commandButton actionListener="#{planBean.simulationBean.cancel}" style="display: none" styleClass="scenarioCancelEditingButton" />
    <ice:commandLink actionListener="#{planBean.simulationBean.edit}" styleClass="editBtn" rendered="#{not planBean.simulationBean.editing and permissions.canEdit}"  />
    
    <script language="javascript">
        jQuery(document).ready(initVersionChoosingBox);
    </script>
</f:view>