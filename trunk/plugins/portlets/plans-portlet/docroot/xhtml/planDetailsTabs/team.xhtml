<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:liferay-faces="http://liferay.com/tld/faces">
    <table class="teamGrid">
        <tr>
            <td class="left">
            <div class="plan-members">
                <div class="center">
                    <ice:commandButton value="Join this team!" actionListener="#{planBean.membershipBean.toggleRequesting}" rendered="#{not planBean.plan.planMember and not planBean.membershipBean.requesting and not planBean.plan.hasRequestedMembership}"  styleClass="#{planBean.plan.planMember ? 'disabled' : ''}" onclick="if(!deferUntilLogin()) return false;"/>
                    <ice:panelGroup rendered="#{planBean.plan.planMember}">
                        <h4>You are part of this team.</h4>
                    </ice:panelGroup>                    
                    <ice:panelGroup rendered="#{planBean.plan.hasRequestedMembership}">
                        <h4>You have asked to be a part of this team.</h4>
                    </ice:panelGroup>
                    <ice:commandButton value="Remove me" actionListener="#{planBean.membershipBean.removeMember}" rendered="#{planBean.plan.planMember and not planBean.membershipBean.requesting}" styleClass="#{planBean.plan.planMember ? 'disabled' : ''}" />
                </div>
                <ice:panelGroup rendered="#{planBean.membershipBean.requesting}" >
                    <div class="manageMembersTop">
                        <h4>Request Membership</h4>
                    </div>
                        <div class="manageMembersContent">
                            Optional comment:
                            <ice:inputTextarea value="#{planBean.membershipBean.comment}" styleClass="requestComment" />
                        </div>
                        <ice:commandButton value="Request membership" styleClass="requestMembershipSubmitButton" actionListener="#{planBean.membershipBean.requestMembership}" />
                        <ice:commandButton value="Cancel" actionListener="#{planBean.membershipBean.toggleRequesting}" />
                    
                </ice:panelGroup>
            
                <div class="sectionTitle">
                    <h3>#{planBean.plan.planMembersCount} Members</h3>
                </div>
                <ice:dataTable value="#{planBean.membershipBean.planMembers}" var="member" styleClass="itemsTable">
                    <ice:column>
                        <f:facet name="header">Screen Name</f:facet>
                        <ice:outputText value="#{member.screenName}" />
                    </ice:column>
                    <ice:column>
                        <f:facet name="header">Joined</f:facet>
                        <ice:outputText value="#{member.screenName}" />
                    </ice:column>
                    <ice:column>
                        <f:facet name="header">Status</f:facet>
                        <f:subview rendered="#{(not permissions.canAdmin or permissions.planUserPermission gt member.planUserPermission or member.planUserPermission == 'OWNER') and not permissions.canAdminAll}" >
                            <ice:outputText value="#{member.planUserPermission.description}" />
                        </f:subview>
                        <ice:selectOneMenu value="#{member.planUserPermissionStr}" rendered="#{(permissions.canAdmin and permissions.planUserPermission le member.planUserPermission and not (member.planUserPermission == 'OWNER')) or permissions.canAdminAll}" partialSubmit="true">
                            <f:selectItems value="#{planBean.membershipBean.availableUserRoles}" />
                        </ice:selectOneMenu>
                    </ice:column>
                    <ice:column rendered="#{permissions.planOwner}">
                        <f:facet name="header">Action</f:facet>
                        <ice:commandLink value="remove" actionListener="#{member.remove}" />
                    </ice:column>
                </ice:dataTable>
            </div>
            
            </td>
            <td class="right">
                <div class="center">
                    <ice:commandButton value="Become a fan!" actionListener="#{planBean.plan.becomeAFan}" rendered="#{not planBean.plan.userAFan}" onclick="if(!deferUntilLogin()) return false;"/>
                    <ice:commandButton value="Remove me" actionListener="#{planBean.plan.unfan}" rendered="#{planBean.plan.userAFan}" />
                </div>
                
                <div class="sectionTitle">
                    <h3>#{planBean.plan.planFansCount} Fans</h3>
                </div>
                <ice:dataTable value="#{planBean.plan.planFans}" var="fan" styleClass="itemsTable">
                    <ice:column>
                        <f:facet name="header">Name</f:facet>
                        #{fan.user.screenName}
                    </ice:column>
                    <ice:column>
                        <f:facet name="header">Since</f:facet>
                        #{fan.created}
                    </ice:column>
                </ice:dataTable>
            
            </td>
        
        
        </tr>
    
    </table>  
</f:view>