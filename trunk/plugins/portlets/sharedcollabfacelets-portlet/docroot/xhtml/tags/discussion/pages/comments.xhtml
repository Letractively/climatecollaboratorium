<?xml version="1.0" encoding="UTF-8"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:collab="http://climatecollaboratorium.org/facelets"
    xmlns:liferay-faces="http://liferay.com/tld/faces">

    <div id="content">
  
    <div id="com-info">
      <div id="info-left">
        <img src="/collaboratorium-theme/images/icon_comments-big.png" width="53" height="50" /> 
        <span>#{discussionBean.commentsCount}</span> comments
        <img src="/collaboratorium-theme/images/icon_new-comment.png" width="44" height="41" class="spc" /> 
        add new comment
      </div>
      
      <div id="pager">
        <table class="floatRight">
            <tr><td>
            <ice:dataPaginator for="commentsTable" rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar" firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex" pageCountVar="pageCount" pageIndexVar="pageIndex" styleClass="paginatorInfo">
                <ice:outputFormat value="page {0} of {1}" styleClass="paginatorInfo" escape="false">
                <f:param value="#{pageIndex}" />
                <f:param value="#{pageCount}" />
            </ice:outputFormat>
        </ice:dataPaginator>    
        </td>
        <td>
            <ice:dataPaginator rendered="true" for="commentsTable" paginator="true" paginatorMaxPages="3" styleClass="controls pagerNext"  pageCountVar="pageCount" pageIndexVar="pageIndex"> 
                <f:facet name="first" rendered="true">
                    <ice:panelGroup />
                </f:facet>
                <f:facet name="last" rendered="true">
                    <ice:panelGroup />
                </f:facet>
                <f:facet name="previous" rendered="true">
                    <ice:outputText value="PREV PAGE" rendered="#{pageIndex > 1}"/>
                </f:facet>
                <f:facet name="next">
                    <ice:outputText value="NEXT PAGE"  rendered="#{pageIndex lt pageCount}" />
                </f:facet>
            </ice:dataPaginator>
            </td>
            </tr>
        </table>
        <div class="clear">&amp;nbsp;</div>
        </div>
    </div>
    
    <ice:panelGroup rendered="#{discussionBean.commentsThread == null}">
        <div>
            No comments have been posted. Be the first one to add a comment.
        </div>
    </ice:panelGroup> 
    <ice:dataTable rows="10" value="#{discussionBean.commentsThread.threadMessages}" var="message" varStatus="messageStatus" columnClasses="l,r" rowClasses="odd,even" id="commentsTable">
        <ice:column>
            <div class="com_num">#{message.messageNum}</div>
            <collab:userLinkSimple text="#{message.author.screenName}" userId="#{message.author.userId}" /> <br />
            <ice:outputText value="#{message.createDate}">
                <f:convertDateTime pattern="MMM. dd, yyyy"/>
            </ice:outputText><br />
            <ice:outputText value="#{message.createDate}">
                <f:convertDateTime pattern="hh:mm a"/>
            </ice:outputText>
        </ice:column>
        
        <ice:column>
            <ice:panelGroup rendered="#{not message.editing}">
                    <h4 class="title">
                        <ice:outputText value="#{message.title}" />
                    </h4>
                    <div class="actions">
                        <ice:commandButton actionListener="#{message.toggleEdit}" value="Edit" rendered='#{discussionBean.permissions.canAdminMessages}'/>
                        <ice:commandButton actionListener="#{message.delete}" value="Delete" rendered='#{discussionBean.permissions.canAdminMessages}'/>
                    </div>
                    <div class="clear"></div>
                    <div class="content">
                        <ice:outputText value="#{message.filteredDescription}" escape="false" />
                    </div>
            </ice:panelGroup>
            <ice:panelGroup rendered="#{message.editing}" styleClass="newMessageForm">
                <ice:outputLabel for="messageTitle" value="Title: " /><br />
                <ice:inputText id="messageTitle" value="#{message.title}" styleClass="title text"/>
                <ice:message for="messageTitle" />
                <br />
                <ice:outputLabel for="messageContent" value="Message: " /><br />
                <ice:inputTextarea id="messageContent"  value="#{message.description}" styleClass="description text"/>
            <ice:message for="messageContent" /><br />
        
                <ice:commandButton actionListener="#{message.updateMessage}" value="Save" />
                <ice:commandButton actionListener="#{message.toggleEdit}" value="Cancel" />
            </ice:panelGroup>
        
        </ice:column>
    </ice:dataTable>
    
    <ice:panelGroup styleClass="newMessageForm" rendered="#{discussionBean.permissions.canAddComment}">
        <ice:outputLabel for="messageTitle" value="Title:" /><br />
        <ice:inputText id="messageTitle" value="#{discussionBean.newComment.title}" styleClass="title text" maxlength="255"/>
        <ice:message for="messageTitle" />
        <br />
        
        <ice:outputLabel for="messageContent" value="Message:" /><br />
        <ice:inputTextarea id="messageContent" value="#{discussionBean.newComment.description}" styleClass="description text" /><br />
        <ice:message for="messageContent" />
        <ice:commandButton value="Add" actionListener="#{discussionBean.newComment.addComment}" />
    </ice:panelGroup>
    </div>
</f:view>