<?xml version="1.0" encoding="UTF-8"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:collab="http://climatecollaboratorium.org/facelets"
    xmlns:liferay-faces="http://liferay.com/tld/faces">

<ui:composition template="./discussionTemplate.xhtml">
    <ui:define name="discussion_breadcrumb">
        <a href="javascript:;" onclick="Collab.nav.navigate('discussion', {pageType: 'CATEGORY', categoryId: #{discussionBean.currentThread.category.id}}); return;"> 
            #{discussionBean.currentThread.category.title}:</a> #{discussionBean.currentThread.title}
    </ui:define>
    <ui:define name="discussion_content">
    <ice:panelSeries value="#{discussionBean.currentThread.threadMessages}" var="message" varStatus="messageStatus">
        <ice:panelGroup rendered="#{not message.editing}">
            <div class="messageLong #{messageStatus.index mod 2 != 0 ? 'odd' : 'even' }">
                <h4 class="title">
                    <ice:outputText value="#{message.title}" />
                </h4>
                <div class="actions">
                    <ice:commandButton actionListener="#{message.toggleEdit}" value="Edit" rendered='#{discussionBean.permissions.canAdminMessages}'/>
                    <ice:commandButton actionListener="#{message.delete}" value="Delete" rendered='#{discussionBean.permissions.canAdminMessages}'/>
                </div>
                <div class="clear"></div>
                <div class="meta">
                    <div class="floatLeft">By &amp;nbsp;
                        <a href="/web/guest/members?userId=#{thread.author.userId}">#{message.author.screenName}</a> 
                    </div>
                    <div class="floatRight">#{message.createDate}</div> 
                    <div class="clear"></div>
                </div>
                <div class="content">
                    <ice:outputText value="#{message.filteredDescription}" escape="false" />
                </div>
            </div>
        </ice:panelGroup>
        <ice:panelGroup rendered="#{message.editing}" styleClass="newMessageForm">
            <ice:outputLabel for="categoryName" value="Title: " /><br />
            <ice:inputText id="categoryName" value="#{message.title}" styleClass="title text"/><br />
        
            <ice:outputLabel for="categoryDescription" value="Message: " /><br />
            <ice:inputTextarea id="categoryDescription"  value="#{message.description}" styleClass="description text"/><br />
        
            <ice:commandButton actionListener="#{message.updateMessage}" value="Save" />
            <ice:commandButton actionListener="#{message.toggleEdit}" value="Cancel" />
        </ice:panelGroup>
    </ice:panelSeries>
    
    <ice:panelGroup styleClass="newMessageForm" rendered="#{discussionBean.permissions.canAddMessage}">
        <ice:outputLabel for="messageTitle" value="Title:" /><br />
        <ice:inputText id="messageTitle" value="#{discussionBean.currentThread.newMessage.title}" styleClass="title text"/>
        <br />
        
        <ice:outputLabel for="messageBody" value="Message:" /><br />
        <ice:inputTextarea id="messageBody" value="#{discussionBean.currentThread.newMessage.description}" styleClass="description text" /><br />
        <ice:commandButton value="Add" actionListener="#{discussionBean.currentThread.newMessage.addMessageToThread}" />
    </ice:panelGroup>
        
    </ui:define>
</ui:composition>

</f:view>