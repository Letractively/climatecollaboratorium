<?xml version="1.0"?>
<f:view 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:liferay-faces="http://liferay.com/tld/faces"
    xmlns:h="http://java.sun.com/jsf/html"  
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    >
    
    <ice:portlet>
    <script type="text/javascript" src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js"></script>
    <script type="text/javascript">
        function populateCaptchaFields() {
            jQuery(".captchaText").val(Recaptcha.get_response())
            jQuery(".captchaChallenge").val(Recaptcha.get_challenge());
        }
    </script>

        <ice:form id="contact">
            <ice:panelGroup styleClass="contactFormExpander" rendered="#{not contactBean.expanded}">
                <ice:commandLink value="#{contactBean.expandFormMessage}" actionListener="#{contactBean.toggleExpanded}" />
            </ice:panelGroup>
            <ice:panelGroup styleClass="contactForm" rendered="#{contactBean.expanded}">
                <table>
                    <tr><td><ice:outputLabel for="name" value="Your name" /></td></tr>
                    <tr><td>
                        <ice:message for="name"/>
                        <ice:inputText value="#{contactBean.name}" id="name" required="true" styleClass="text" />
                    </td></tr>
                
                    <tr><td><ice:outputLabel for="email" value="E-mail (only for reply)" /></td></tr>
                    <tr><td>
                        <ice:message for="email" />
                        <ice:inputText value="#{contactBean.email}" id="email" required="true" styleClass="text">
                            <f:validator validatorId="emailValidator" />
                        </ice:inputText>
                    
                    </td></tr>
            
                    <tr><td><ice:outputLabel for="message" value="Message"/></td></tr>
                    <tr><td>
                        <ice:message for="message" />
                        <ice:inputTextarea value="#{contactBean.message}" id="message"  styleClass="longtext"  required="true" />
                    
                    
                    </td></tr>
                
                    <tr><td><ice:outputLabel value="Captcha" /></td></tr>
                    <tr><td>
                    
                        <script type="text/javascript">
                            // #{contactBean.tryNumber}
                            jQuery(document).ready(function() {
                                Recaptcha.destroy();
                                Recaptcha.create("#{contactBean.captchaPublicKey}", "recaptcha_div", {});
                            });
                        </script>
                        <ice:inputText id="captchaChallenge" value="#{contactBean.captchaChallenge}" styleClass="hidden captchaChallenge" required="true"></ice:inputText>
                        <ice:inputText id="captcha" value="#{contactBean.captchaText}" styleClass="hidden captchaText" required="true" >
                            <f:validator validatorId="captchaValidator" />
                            <f:attribute name="challengeId" value="captchaChallenge" />
                        </ice:inputText>
                        
                        
                        <div id="recaptcha_div"></div>
                        
                        <ice:message for="captcha" />
                    
                    </td></tr>
                    <tr><td>
                        <ice:commandButton value="Send" actionListener="#{contactBean.sendMessage}" onclick="populateCaptchaFields();"/>
                        <ice:commandButton value="Cancel" actionListener="#{contactBean.toggleExpanded}" partialSubmit="true" immediate="true" />
                    
                    </td></tr>
                </table>
            </ice:panelGroup>
        </ice:form>
    <ice:messages globalOnly="true" />
    </ice:portlet>
</f:view>
