<?xml version="1.0"?>
<f:view 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:liferay-faces="http://liferay.com/tld/faces"
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:h="http://java.sun.com/jsf/html"  >
    
    <ice:panelGroup styleClass="portlet">
        <div class="container">
            <h4><a href="/web/guest/plans">&amp;lt;&amp;lt; Back to plans index</a></h4>
            <div class="container_top">
                <div class="topActions">
                    <ice:form>
                        <ui:include src="./createPlan.xhtml">
                            <ui:param value="#{planBean.createPlanBean}" name="createPlanBean" />
                        </ui:include>
                        
                        <a href="javascript:;" onclick="if(!deferUntilLogin()) return false; showCreatePlanDialog()" >create new plan based on this</a> |&amp;nbsp;
                        <ice:commandLink value="subscribe" onclickactionListener="#{planBean.plan.subscribe}" />
                    </ice:form>
                </div>
                <ice:form>
                    <div class="title">
                        <div class="icon">
                            <f:subview rendered="#{not planBean.editingName}">
                                <h2><ice:outputText value="#{planBean.plan.name}" /></h2>
                                <div class="actions textual">
                                    <ice:commandLink value="rename" actionListener="#{planBean.editName}" rendered="#{permissions.canEdit}"/>
                                </div>
                                
                            </f:subview>
                            <f:subview rendered="#{planBean.editingName}">
                                
                                <ice:inputText value="#{planBean.plan.name}" id="renamePlanName">
                                    <f:validator validatorId="planNameValidator" />
                                </ice:inputText>
                                <div class="actions">
                                    <ice:commandLink actionListener="#{planBean.plan.saveName}" styleClass="checkBtn"/>&amp;nbsp;&amp;nbsp;
                                    <ice:commandLink actionListener="#{planBean.editName}" styleClass="cancelBtn" immediate="true" />
                                </div>
                                <ice:message for="renamePlanName" styleClass="renamePlanMessage" />
                            </f:subview>
                        
                        <div class="clear"></div>
                        </div>
                    
                    <ice:outputConnectionStatus/>
                    <f:subview rendered="#{not planBean.editingName}">
                        <div class="planVotes">
                            #{planBean.plan.votes} (#{planBean.votesPercent}%) votes.&amp;nbsp;
                            <ice:commandLink value="Vote for this plan" actionListener="#{planBean.plan.vote}" rendered="#{not planBean.plan.votedOn}" />
                            <ice:commandLink value="Retract your vote for this plan" actionListener="#{planBean.plan.unvote}" rendered="#{planBean.plan.votedOn}" />
                        </div>
                    </f:subview>
                </div>
                </ice:form>
            </div>
            <div class="container_middle">
                <div class="content">
                    <ice:form>
                        <ice:panelTabSet styleClass="mainTabs" columnClasses="description,assumptions,models,actionsImpacts,discussion,team">
                            <ice:panelTab label="Description">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/description.xhtml" />
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Positions">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/assumptions.xhtml" />
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Models">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/models.xhtml" />
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Actions &amp; Impacts" styleClass="actionsImpacts">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/actionsImpacts.xhtml" />
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Discussion">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/discussion.xhtml" />
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Team">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/team.xhtml" />
                                </f:subview>
                            </ice:panelTab>
                        </ice:panelTabSet>
                    </ice:form>
                </div>
            </div> <!-- .container_middle -->
            <div class="container_bottom"></div>
        </div> <!-- .container -->
    </ice:panelGroup>
</f:view>
