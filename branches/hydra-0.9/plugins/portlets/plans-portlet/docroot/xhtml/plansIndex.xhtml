<?xml version="1.0"?>
<f:view  xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:liferay-faces="http://liferay.com/tld/faces" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html">

    <div class="plan-question">
        <h2>
            <a href="/web/guest/resources/-/wiki/Main/Background+on+Copenhagen">
                What plan should be adopted at the UN climate talks?
            </a>
        </h2>
    </div>
    <div class="page-context-help-container">
        <a href="/web/guest/resources/-/wiki/Main/Plans">What are plans?</a>
    </div>
    
    <ice:form>
        <ui:include src="./configureColumns.xhtml" >
            <ui:param value="#{plansIndexBean.columnsConfiguration}" name="columnsConfiguration" />
        </ui:include>
        <ui:include src="./filterPlans.xhtml" >
             <ui:param value="#{plansIndexBean.filterPlansBean}" name="filterPlans" /> 
        </ui:include>
        <ui:include src="./createPlan.xhtml">
             <ui:param value="#{navigation.createPlanBean}" name="createPlanBean" />
        </ui:include>
        
        <f:subview rendered="#{plansIndexBean.findUserVote}">
            <ui:include src="./findUserVote.xhtml" />
        </f:subview>
         <div class="tab">
            <div class="tabs floatRight">
                <ice:commandLink styleClass="#{plansIndexBean.planType.published ? 'finalizedHover' : 'finalized'}" actionListener="#{plansIndexBean.usePublishedPlans}"><span class="hidden">Finalized Plans (For Voting)</span></ice:commandLink>
                <ice:commandLink styleClass="#{plansIndexBean.planType.published ? 'development' : 'developmentHover'}" actionListener="#{plansIndexBean.useUnPublishedPlans}"><span class="hidden">Plans Under Development</span></ice:commandLink>
            </div>
            <div class="planactions floatLeft">
                <a class="createNewPlan" href="javascript:;" onclick="if(!deferUntilLogin()) return false; showCreatePlanDialog()" ><span class="hidden">Create a New Plan</span></a>
                
                <f:subview rendered="#{plansIndexBean.planType.published and plansIndexBean.hasUserVoted}">
                    <ice:commandLink styleClass="findMyVoteBtn" actionListener="#{plansIndexBean.findUserVote}"><span class="hidden">Find my Vote</span></ice:commandLink>
                </f:subview>
            </div>
         </div>
         
         <div class="clear"></div>
         <div class="tabContent_bottom">
            <div class="topBtn">
                <h3 class="floatRight">
                    <f:subview rendered="#{plansIndexBean.planType.published}">
                        #{plansIndexBean.plansCount} finalized plans, #{plansIndexBean.votesCount} total votes
                    </f:subview>
                    <f:subview rendered="#{not plansIndexBean.planType.published}">
                        #{plansIndexBean.plansCount} plans under development
                    </f:subview>
                    
                    <ice:outputConnectionStatus/>
                </h3>
                <div class="floatLeft linkbox">
                    <a class="configuration black" href="javascript:;" onclick="showConfigureColumnsDialog()">Select Columns</a>
                    <span>|</span>
                    <a class="preferences black" href="javascript:;" onclick="showFilterPlansDialog()">Filter Plans</a>
                    <span>|</span>
                    <span class="enable-filters">
                        <ice:selectBooleanCheckbox value="#{plansIndexBean.filterPlansBean.enabled}" styleClass="filtersEnabledCheckbox" onclick="toogleFiltersEnabled()">
                            Enable filter
                        </ice:selectBooleanCheckbox>
                    </span>
                </div>
            </div>
            <div class="clear"></div>
                <ice:dataTable value="#{plansIndexBean.plans}" styleClass="plansTable" rowClasses="odd,even" var="singlePlan" sortColumn="#{plansIndexBean.sortColumn}"
                    sortAscending="#{plansIndexBean.sortAscending}" id="plansIndex" rows="#{plansIndexBean.pageSize}" headerClass="#{plansIndexBean.columns}">
                    <ice:columns value="#{plansIndexBean.columns}" var="column">
                            <f:facet name="header">
                                <div>
                                <div class="popup-info-box hidden" id="info-popup-#{column}">#{column.description}</div>
                                <div class="popup-info-button" id="info-button-#{column}"><span class="hidden">Info</span></div>
                                <div class="clear"></div>
                                <ice:commandSortHeader columnName="#{column}">
                                         <ice:outputText value="#{column.name}" escape="false"/>
                                </ice:commandSortHeader>
                                </div>
                            </f:facet>
                            <ice:outputLink value="#plans=planId:#{singlePlan.planId}" rendered="#{column == 'NAME'}" onclick="Collab.nav.navigate('plans', {planId: '#{singlePlan.planId}'})" >
                                <ice:outputText value="#{singlePlan.columnValues[column]}" styleClass="#{column}"/>
                            </ice:outputLink>
                            <f:subview rendered="#{column == 'POSITIONS' and !singlePlan.hasPositions}">
                                N/A
                            </f:subview>
                            <f:subview rendered="#{column == 'POSITIONS' and singlePlan.hasPositions}">
                                <a href="javascript:;" class="showPositions" onclick="showPositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}');return;"/>
                                <div class="hidden" id="plan_positions_#{singlePlan.planId}">
                                    <div class="positionsDialog">
                                        <div class="positionsDialog_top">
                                            <div class="title"><h2>Positions for #{singlePlan.planName}</h2></div>
                                        </div>
                                        <div class="positionsDialog_bg">
                                            <div class="scrollBox">
                                            <ice:panelSeries value="#{singlePlan.positions}" var="question">
                                                <div class="assumption">
                                                    <h3 class="question">#{question.debateSummary}</h3>
                                                    <h4 class="position">#{question.selectedPosition.debateSummary}</h4>
                                                </div>
                                            </ice:panelSeries>
                                            </div>
                                        </div>
                                        <div class="positionsDialog_bottom">
                                            <a href="javascript:;" onclick="hidePositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}')">Dismiss</a>
                                        </div>
                                    </div>
                                </div>
                            </f:subview>
                            
                            <ice:outputText value="#{singlePlan.columnValues[column]}" rendered="#{column != 'NAME' and column != 'POSITIONS'}" escape="false"/>
                    </ice:columns>
                    <ice:column rendered="#{plansIndexBean.planType.published}">
                        <f:facet name="header"><div class="voteForPlan"><span>Vote for Plan</span></div></f:facet>
                        <ice:commandLink actionListener="#{singlePlan.vote}" onclick="if(! deferUntilLogin()) return false; " styleClass="indexVoteForPlan #{singlePlan.votedOn ? 'en userVote' : 'dis'} "></ice:commandLink>
                    </ice:column>
                </ice:dataTable>
                <ice:panelGroup styleClass="hidden">
                    #{plansIndexBean.plans}
                <script language="javascript">
                        initializeColumnsInfo();
                        makeNANotesVisible();
                    </script>
                </ice:panelGroup>
                
        <div class="pageBottom">
        
            <div class="pageNum">
                
                
          <ice:dataPaginator id="dataScroll_2" for="plansIndex" rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar" firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex" pageCountVar="pageCount" pageIndexVar="pageIndex" styleClass="paginatorInfo">
                <ice:outputFormat value="Displaying &lt;strong&gt;{0}&lt;/strong&gt; - &lt;strong&gt;{1}&lt;/strong&gt; of &lt;strong&gt;{2}&lt;/strong&gt; Plans" styleClass="paginatorInfo" escape="false">
                    <f:param value="#{firstRowIndex}" />
                    <f:param value="#{lastRowIndex}" />
                    <f:param value="#{rowsCount}" />
                </ice:outputFormat>
            </ice:dataPaginator> 
            
            <ice:dataPaginator id="dataScroll_1" rendered="true" for="plansIndex" paginator="true" paginatorMaxPages="1" styleClass="paginator" > 
                <f:facet name="first" rendered="true">
                    <ice:panelGroup>
                        <ice:outputText value="First Page" styleClass="first" />
                    </ice:panelGroup>
                </f:facet>
                <f:facet name="last" rendered="true">
                    <ice:panelGroup>
                        <ice:outputText value="Last Page" styleClass="last" />
                    </ice:panelGroup>
                </f:facet>
                <f:facet name="previous" rendered="true">
                    <ice:panelGroup> 
                        <ice:outputText value="Previous" styleClass="prev"/>
                    </ice:panelGroup>
                </f:facet>
                <f:facet name="next">
                    <ice:panelGroup>
                        <ice:outputText value="Next" styleClass="next"/>
                    </ice:panelGroup>
                </f:facet>
            </ice:dataPaginator>
                <div class="clear"></div>
        </div>
                <div class="clear"></div>
        </div> 
        
        
                <div class="clear"></div>       
                </div>
        
        
        
        
    </ice:form>



</f:view>