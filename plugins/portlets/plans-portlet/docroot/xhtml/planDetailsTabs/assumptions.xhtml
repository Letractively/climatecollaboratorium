<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:collab="http://climatecollaboratorium.org/components">

    <ice:panelGroup styleClass="hidden">
        <script type="text/javascript">
            Collab.nav.addEditorDirtyValidationCallback(checkIfActionsImpactsDirty);
        </script>
    </ice:panelGroup>
    
    <collab:helpMessage messageId="planPositionHelp" styleClass="planHelp" hideThisMessage="Hide this message">
        Positions articulate the choices made by a plan on a set of issues relevant for all plans in a category.
    </collab:helpMessage>
    <collab:helpMessageTrigger messageId="planPositionHelp">+show help</collab:helpMessageTrigger>

    <div class="versionEditToolbar">
        <div class="chooseVersionWidget">
            <input type="button" value="See Old Versions" class="versionsTrigger expand"/>

            <div class="versionsContainer relative">
                <div class="versions">
                    <ice:selectOneListbox value="#{planBean.planPositionsBean.planPositionsVersion}"
                                          partialSubmit="true" size="10">
                        <f:selectItems value="#{planBean.planPositionsBean.planPositionsVersions}"/>
                    </ice:selectOneListbox>
                    <br/>
                    <input type="button" value="Hide" class="versionsTrigger collapse"/>
                </div>
                <ice:panelGroup>
                    <script language="javascript">
                        jQuery(document).ready(initVersionChoosingBox);
                    </script>
                </ice:panelGroup>
            </div>
        </div>
        <ice:commandButton styleClass="editButton" value="Edit" actionListener="#{planBean.planPositionsBean.edit}"
                           rendered="#{not planBean.planPositionsBean.editing and permissions.canEdit}"/>

        <div class="clear"></div>
    </div>


    <ice:panelGroup rendered="#{not planBean.planPositionsBean.editing}">
        <ice:panelGroup styleClass="versionInfo" rendered="#{not planBean.planPositionsBean.latestVersion}">
            Viewing version from &amp;nbsp; <strong><ice:outputText value="#{planBean.planPositionsBean.versionDate}"/></strong> by &amp;nbsp;
            <a href="/web/guest/members?userId=#{planBean.planPositionsBean.versionAuthor.userId}">
                <strong><ice:outputText value="#{planBean.planPositionsBean.versionAuthor.screenName}"/></strong>
            </a>
        </ice:panelGroup>
        <ice:panelSeries value="#{planBean.planPositionsBean.availablePositions}" var="question">
            <div class="assumption">
                <h3 class="question">#{question.debateAnchor}</h3>
                <h4 class="position">#{question.selectedPosition.itemAnchor}</h4>
            </div>
        </ice:panelSeries>
        <ice:panelGroup rendered="#{not planBean.planPositionsBean.positionsSet}">
            <div class="nothingSetInfo">
                <div class="nothingSetMessage">No assumptions set.</div>
            </div>
        </ice:panelGroup>
    </ice:panelGroup>

    <ice:messages/>


    <ice:panelGroup rendered="#{planBean.planPositionsBean.editing}" styleClass="editWithVersions">

        <ice:panelGroup>
            <ice:panelSeries value="#{planBean.planPositionsBean.availablePositions}" var="question">
                <div class="assumption">
                    <h3 class="question">#{question.debateAnchor}</h3>
                    <ice:selectOneRadio value="#{question.position}" styleClass="versionedRadio positionItem"
                                        layout="pageDirection">
                        <f:selectItems value="#{question.positions}"><br/></f:selectItems>
                    </ice:selectOneRadio>
                </div>

            </ice:panelSeries>
            <ice:panelGroup>
                <script language="javascript">
                    updatePositionsSelection(#{planBean.planPositionsBean.selectedPositionsIds});
                </script>
            </ice:panelGroup>
            <ice:commandButton actionListener="#{planBean.planPositionsBean.updatePositions}" value="Save"/>
            <ice:commandButton actionListener="#{planBean.planPositionsBean.edit}" value="Cancel"/>
        </ice:panelGroup>

    </ice:panelGroup>
    

</f:view>