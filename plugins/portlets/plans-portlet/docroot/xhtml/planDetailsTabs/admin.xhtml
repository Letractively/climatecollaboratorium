<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:collab="http://climatecollaboratorium.org/components">
    <collab:helpMessage messageId="planAdminHelp" styleClass="planHelp"
                                hideThisMessage="Hide this message">
        Teams can choose settings their proposal's status and editing options.  Teams can also seek help from other Climate CoLab members.

        All versions get saved and can be viewed (and reverted, if desired) in a proposal's History.

                  <a href="/web/guest/resources/-/wiki/Main/About+proposals">See more</a>.
            </collab:helpMessage>
            <collab:helpMessageTrigger messageId="planAdminHelp">+show help</collab:helpMessageTrigger>
   

    <table class="teamGrid">
        <tr>
            <td class="left">
                <div class="sectionTitle">
                    <h3>Permissions</h3>
                </div>
                <p>
                    <ice:outputText value="This plan is open (anyone can edit this plan)" rendered="#{planBean.plan.open}" />
                    <ice:outputText value="Only team members can edit this plan" rendered="#{not planBean.plan.open}" />
                </p>
                <div class="center">
                    <ice:commandButton value="Open this plan" rendered="#{not planBean.plan.open and permissions.canAdmin}"  actionListener="#{planBean.plan.toggleOpen}" />
                    <ice:commandButton value="Close this plan" rendered="#{planBean.plan.open and permissions.canAdmin}" actionListener="#{planBean.plan.toggleOpen}" />
                </div> 
                
                <div class="sectionTitle">
                 <h3>Status</h3>
                </div>
                <table>
                    <tr>
                    
                        <td>
                            <ice:outputText value="#{planBean.plan.status.description}" />
                        </td>
                        <f:subview rendered="#{permissions.canAdmin}">
                            <td>
                                <ice:commandButton value="#{planBean.plan.status == 'SUBMITTED' ? 'Withdraw submission' : 'Submit'}" actionListener="#{planBean.plan.toggleSubmitted}" />
                            </td>
                        </f:subview>
                    </tr>
                </table>
                
                <div class="sectionTitle">
                    <h3>Ask for help:</h3>
                </div>
                <div class="center">
                    <ice:selectBooleanCheckbox value="#{planBean.plan.seekingAssistance}" partialSubmit="true" />
                    Display an indicator to other community members that you would like help with this proposal
                    
                </div> 
            
            <div class="plan-membership-requests">
                <div class="sectionTitle">
                    <h3>Membership requests</h3>
                </div>
                <ice:dataTable value="#{planBean.membershipBean.planMembershipRequests}" var="membershipRequest" styleClass="itemsTable">
                    <ice:column>
                        <f:facet name="header">Screen Name</f:facet>
                        <ice:outputText value="#{membershipRequest.screenName}" />
                    </ice:column>
                    <ice:column>
                        <f:facet name="header">Date</f:facet>
                        <ice:outputText value="#{membershipRequest.requestDate}" />
                    </ice:column>
                    <ice:column rendered="#{permissions.canAdmin}">
                        <f:facet name="header">Action</f:facet>
                        <a href="javascript:;" onclick="showManageMembershipRequestDialog('manage_membership_request_#{membershipRequest.id}')">
                            View
                        </a>
                        <div id="manage_membership_request_#{membershipRequest.id}">
                            <div class="content hidden">
                                <div class="manageMembersTop">
                                    <h4>Respond to membership request</h4>
                                </div>
                                <div class="manageMembersContent">
                                    User comment: 
                                    <p class="userComment">
                                        <ice:outputText value="#{membershipRequest.comment}" />
                                    </p>
                                    Optional message to requestor:<br />
                                    <ice:inputTextarea value="#{membershipRequest.response}" styleClass="membershipRequestResponse" />
                                    Action:
                                    <ice:selectOneRadio value="#{membershipRequest.approve}">
                                        <f:selectItem itemValue="true" itemLabel="approve" />
                                        <f:selectItem itemValue="false" itemLabel="deny" />
                                    </ice:selectOneRadio>
                                </div>
                                <div class="manageMembersActions">
                                    <a class="checkBtn first" href="javascript:;" onclick="respondToMembershipRequest('manage_membership_request_#{membershipRequest.id}')"></a>
                                    <a class="cancelBtn"  href="javascript:;" onclick="hideManageMembershipRequestDialog('manage_membership_request_#{membershipRequest.id}')"></a>
                                </div>
                            </div>
                            <ice:commandLink actionListener="#{membershipRequest.update}" styleClass="hidden membershipRequestResponseSubmitButton" />
                        </div>
                    </ice:column>
                
                </ice:dataTable>
                <div id="manage_membership_request_dialog"></div>
            </div>
            <ice:panelGroup rendered="#{permissions.planOwner}">
                <div class="sectionTitle">
                    <h3>Owner actions</h3>
                </div>
                    <ice:commandButton value="Delete plan" rendered="#{permissions.canAdmin}"  actionListener="#{planBean.plan.delete}" onclick="if(!confirm('Are you sure you want to proceed with removal?')){ return false; }"/>
            </ice:panelGroup>
            </td>
            <td class="right">
                <div class="sectionTitle">
                    <h3>History</h3>
                </div>
                <ice:dataTable value="#{planBean.plan.allVersions}" var="planVersion" styleClass="itemsTable">
                    <ice:column>
                        <f:facet name="header">Update Date</f:facet>
                        #{planVersion.updateDate}
                    </ice:column>
                    <ice:column>
                        <f:facet name="header">Update Author</f:facet>
                        #{planVersion.updateAuthor.screenName}
                    </ice:column>
                    <ice:column>
                        <f:facet name="header">Update Type</f:facet>
                        #{planVersion.updateType}
                    </ice:column>
                </ice:dataTable>
            
            </td>
        
        
        </tr>
    
    </table>
    <div class="hidden" id="request_membership">
        <div id="request_membership_dialog_contents">
            <div class="manageMembersTop">
                <h4>Request Membership</h4>
            </div>
            <div class="manageMembersContent">
                Optional comment:
                <ice:inputTextarea value="#{planBean.membershipBean.comment}" styleClass="requestComment" />
            </div>
            <div class="manageMembersActions">
                <a class="checkBtn first" href="javascript:;" onclick="requestMembership()"></a>
                <a class="cancelBtn"  href="javascript:;" onclick="hideRequestMembershipDialog()"></a>
            </div>
            <ice:commandButton value="Request membership" styleClass="requestMembershipSubmitButton hidden" actionListener="#{planBean.membershipBean.requestMembership}" />
        </div>
    </div>
    <div class="hidden" id="request_membership_dialog">
    </div> 
    <!--  if plan has been deleted, redirect user to plansIndex -->
    <f:subview rendered="#{planBean.plan.deleted}">    
    <script language="javascript">
        Collab.nav.navigate("plans", {});
    </script>
</f:subview>
    
</f:view>