<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:collab="http://climatecollaboratorium.org/components"
        xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <collab:helpMessage messageId="planTeamHelp" styleClass="planHelp"
                        hideThisMessage="Hide this message">
        Climate CoLab members can join teams that are developing proposals or become supporters of proposals.
        <a href="/web/guest/resources/-/wiki/Main/Teams">See more</a>.
    </collab:helpMessage>
    <collab:helpMessageTrigger messageId="planTeamHelp">+show help</collab:helpMessageTrigger>


    <table class="teamGrid">
        <tr>
            <td class="left">
                <h2>Team:</h2>
                 <div class="supportStatus">

                    <ice:outputText rendered="#{planBean.plan.planMember}" escape="false"
                                    styleClass="floatLeft">
                        <h3>You are part of this team.</h3>
                    </ice:outputText>
                    <ice:outputText rendered="#{planBean.plan.hasRequestedMembership}" escape="false"
                                    styleClass="floatLeft">
                        <h3>You have asked to be a part of this team.</h3>
                    </ice:outputText>
                     <ice:outputText rendered="#{not planBean.plan.planMember}" escape="false"
                                    styleClass="floatLeft">
                        <h3>Become a part of this team!</h3>
                    </ice:outputText>

                    <ice:commandButton value="#{planBean.plan.open?'Join this team':'Request membership'}"
                                       actionListener="#{planBean.membershipBean.toggleRequestingOrJoin}"
                                       rendered="#{not planBean.plan.planMember and not planBean.membershipBean.requesting and not planBean.plan.hasRequestedMembership }"
                                       onclick="if(!deferUntilLogin()) return false;" styleClass="floatRight"/>
                    <ice:commandButton value="Remove me" actionListener="#{planBean.membershipBean.removeCurrentUser}"
                                       rendered="#{planBean.plan.planMember and not planBean.membershipBean.requesting}"
                                       styleClass="#{planBean.plan.planMember ? 'disabled' : ''} floatRight"/>
                </div>
                <div class="clear"></div>

                <ice:panelGroup rendered="#{planBean.membershipBean.requesting}">
                    <div class="manageMembersTop">
                        <h4>Request Membership</h4>
                    </div>
                    <div class="manageMembersContent">
                        Optional comment:
                        <ice:inputTextarea value="#{planBean.membershipBean.comment}" styleClass="requestComment"/>
                    </div>
                    <ice:commandButton value="Request membership" styleClass="requestMembershipSubmitButton"
                                       actionListener="#{planBean.membershipBean.requestMembership and not planBean.membershipBean.requesting}"/>
                    <ice:commandButton value="Cancel" actionListener="#{planBean.membershipBean.toggleRequesting}"/>

                </ice:panelGroup>
            </td>
            <td class="right">
                <h2>Supporters:</h2>

                <div class="supportStatus">

                    <ice:outputText rendered="#{planBean.plan.userAFan}" escape="false"
                                    styleClass="floatLeft">
                        <h3>You are a supporter</h3>
                    </ice:outputText>
                    <ice:outputText rendered="#{not planBean.plan.userAFan}" escape="false"
                                    styleClass="floatLeft">
                        <h3>You are not a supporter</h3>
                    </ice:outputText>

                    <ice:commandButton value="Become a supporter!" actionListener="#{planBean.plan.becomeAFan}"
                                       rendered="#{not planBean.plan.userAFan}"
                                       onclick="if(!deferUntilLogin()) return false;" styleClass="floatRight"/>
                    <ice:commandButton value="Remove me" actionListener="#{planBean.plan.unfan}"
                                       rendered="#{planBean.plan.userAFan}" styleClass="floatRight"/>
                </div>
                <div class="clear"></div>
            </td>
        </tr>
        <tr>
            <td class="left">


                <ice:panelGroup styleClass="entryCount" rendered="#{planBean.plan.planMembersCount > 0}">
                    <i>#{planBean.plan.planMembersCount} Member#{planBean.plan.planMembersCount>1?"s":''}</i>
                </ice:panelGroup>
                <ice:dataTable value="#{planBean.membershipBean.planMembers}" var="member" styleClass="basicTable"
                               rowClasses="odd,even">
                    <ice:column>
                        <f:facet name="header">Screen Name</f:facet>
                        <ice:outputText value="#{member.screenName}"/>
                    </ice:column>
                    
                    <ice:column>
                        <f:facet name="header">Status</f:facet>
                        <f:subview
                                rendered="#{(not permissions.canAdmin or permissions.planUserPermission gt member.planUserPermission or member.planUserPermission == 'OWNER') and not permissions.canAdminAll}">
                            <ice:outputText value="#{member.planUserPermission.description}"/>
                        </f:subview>
                        <ice:selectOneMenu value="#{member.planUserPermissionStr}"
                                           rendered="#{(permissions.canAdmin and permissions.planUserPermission le member.planUserPermission and not (member.planUserPermission == 'OWNER')) or permissions.canAdminAll}"
                                           partialSubmit="true">
                            <f:selectItems value="#{planBean.membershipBean.availableUserRoles}"/>
                        </ice:selectOneMenu>
                    </ice:column>
                    <ice:column rendered="#{permissions.planOwner}">
                        <f:facet name="header">Action</f:facet>
                        <ice:commandLink value="remove" actionListener="#{member.remove}"/>
                    </ice:column>
                </ice:dataTable>


            </td>
            <td class="right">

                <ice:panelGroup styleClass="entryCount" rendered="#{planBean.plan.planFansCount > 0}">
                    <i>#{planBean.plan.planFansCount} Supporter#{planBean.plan.planFansCount>1?'s':''} </i>
                </ice:panelGroup>
                <ice:panelGroup styleClass="entries">
                    <ice:panelGroup rendered="#{fn:length(planBean.plan.planFans) == 0}" escape="false"
                                    styleClass="noEntries">
                        <i>No supporters</i>
                    </ice:panelGroup>
                    <ice:dataTable value="#{planBean.plan.planFans}" var="fan" styleClass="basicTable"
                                   rendered="#{fn:length(planBean.plan.planFans) > 0}" rowClasses="odd,even">
                        <ice:column>
                            <f:facet name="header">Name</f:facet>
                            #{fan.user.screenName}
                        </ice:column>
                        <ice:column>
                            <f:facet name="header">Since</f:facet>
                            #{fan.created}
                        </ice:column>
                    </ice:dataTable>
                </ice:panelGroup>

            </td>


        </tr>

    </table>
</f:view>