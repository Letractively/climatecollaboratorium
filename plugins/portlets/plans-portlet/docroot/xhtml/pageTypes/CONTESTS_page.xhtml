<?xml version="1.0"?>
<f:view
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:collab="http://climatecollaboratorium.org/facelets"
        xmlns:sharedcollab="http://climatecollaboratorium.org/components">

    <ui:composition template="../templates/singlePageWithBreadcrumb.xhtml">
        <ui:define name="plans_content">
            <ice:panelSeries value="#{contests.contests}" var="singleContest">
            
            <ice:form>
                <ice:panelGroup styleClass="categoryHeader" rendered="#{not singleContest.editor.editing}">
                    <h2><ice:outputText styleClass="categoryName" value="#{singleContest.name}"/></h2>
                    <ice:commandButton styleClass="editCategoryButton" value="Edit" action="#{singleContest.editor.edit}" rendered="#{not singleContest.editor.editing and permissions.canAdminAll}"/>
                </ice:panelGroup>
                <ice:panelGroup styleClass="categoryHeader" rendered="#{singleContest.editor.editing}">
                    <ice:outputLabel for="name">Name</ice:outputLabel>
                    <h2><ice:inputText id="name" styleClass="categoryName" value="#{singleContest.editor.name}"/></h2>
                </ice:panelGroup>
                <ice:panelGroup styleClass="categoryShortName" rendered="#{singleContest.editor.editing}">
                    <ice:outputLabel for="shortName">Short name</ice:outputLabel>
                    <ice:inputText id="shortName" value="#{singleContest.editor.shortName}"/>
                </ice:panelGroup>
                <ice:panelGroup styleClass="categoryDescription" rendered="#{not singleContest.editor.editing}">
                    <ice:outputLabel for="description">Description</ice:outputLabel>
                    <ice:outputText id="description" value="#{singleContest.description}" escape="false" />
                </ice:panelGroup>
                <ice:panelGroup styleClass="categoryDescription" rendered="#{singleContest.editor.editing}">
                    <ice:inputTextarea value="#{singleContest.editor.description}"/>
                </ice:panelGroup>
                <ice:panelGrid columns="2" styleClass="editCategory buttonPanel" rendered="#{singleContest.editor.editing}">
                    <ice:commandButton value="Save" action="#{singleContest.editor.save}"/>
                    <ice:commandButton value="Cancel" action="#{singleContest.editor.cancel}"/>
                </ice:panelGrid>
            </ice:form>
            
            <table class="contestNavItems">
                <tr>
                    <td>
                        <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'},subview:issues" class="#{contest.subView == 'ISSUES' ? 'active' : ''}">Debate the issues!</a>
                    </td>
                    <td>
                        <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'},subview:model" class="#{contest.subView == 'MODEL' ? 'active' : ''}">Run the model!</a>
                    </td>
                </tr>
            </table>
        
            <ice:form>
            
            <div class="contestContent">
    <ice:dataTable value="#{singleContest.plansIndex.plans}" styleClass="plansTable" rowClasses="odd,even"
            var="singlePlan" sortColumn="#{plansIndex.sortColumn}"
            sortAscending="#{plansIndex.sortAscending}" id="plansIndex"
            rows="#{preferences.maxProposalsPerContest[singleContest.contest.contestPK]}" headerClass="#{plansIndex.columns}">
        <ice:columns value="#{plansIndex.columns}" var="column">
            <f:facet name="header">
                <div>
                    <div class="popup-info-box hidden" id="info-popup-#{column}">#{column.description}</div>
                    <div class="clear"></div>
                    <ice:commandSortHeader styleClass="column-hover" columnName="#{column}">
                        <ice:outputText id="column-#{column}" value="#{column.name}" escape="false"/>
                    </ice:commandSortHeader>
                </div>
            </f:facet>
            <ice:outputLink rendered="#{column == 'NAME'}"
                    value="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'},subview:proposals,planId:#{singlePlan.planId}" 
                    onclick="Collab.nav.navigate('plans', {contests: '#{singleContest.contestActive ? 'active' : 'past'}', subview: 'proposals', planId: #{singlePlan.planId}}, true); return false;">
                <ice:outputText value="#{singlePlan.columnValues[column]}" styleClass="#{column}"/>
            </ice:outputLink>
            <f:subview rendered="#{column == 'POSITIONS' and !singlePlan.hasPositions}">
                N/A
            </f:subview>
            <f:subview rendered="#{column == 'POSITIONS' and singlePlan.hasPositions}">
                <a href="javascript:;" class="showPositions"
                        onclick="showPositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}');return;"/>
                <div class="hidden" id="plan_positions_#{singlePlan.planId}">
                    <div class="positionsDialog">
                        <div class="positionsDialog_top">
                            <div class="title"><h2>Positions for #{singlePlan.planName}</h2></div>
                        </div>
                        <div class="positionsDialog_bg">
                            <div class="scrollBox">
                                <ice:panelSeries value="#{singlePlan.positions}" var="question">
                                    <div class="assumption">
                                        <h3 class="question">#{question.debateAnchor}</h3>
                                        <h4 class="position">#{question.selectedPosition.itemAnchor}</h4>
                                    </div>
                                </ice:panelSeries>
                            </div>
                        </div>
                        <div class="positionsDialog_bottom">
                            <a href="javascript:;"
                                    onclick="hidePositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}')">Close</a>
                        </div>
                    </div>
                </div>
            </f:subview>
            <f:subview rendered="#{column == 'SEEKING_ASSISTANCE' and singlePlan.columnValues[column] == 'true'}">
                <img src="/collaboratorium-theme/images/hand_icon.png" />
            </f:subview>
            <f:subview rendered="#{column == 'IS_PLAN_OPEN'}">
                <ice:outputText value="Anyone" rendered="#{singlePlan.columnValues[column] == 'true'}" />
                <ice:outputText value="Team only" rendered="#{singlePlan.columnValues[column] != 'true'}" />
            </f:subview>
            <ice:outputText value="#{singlePlan.columnValues[column]}"
                    rendered="#{column != 'NAME' and column != 'POSITIONS' and column != 'SEEKING_ASSISTANCE' and column != 'IS_PLAN_OPEN'}" escape="false"/>
        </ice:columns>
        <ice:column rendered="#{plansIndex.contestPhase.canVote}">
            <f:facet name="header">
                <div class="voteForPlan"><span>Vote for Plan</span></div>
            </f:facet>
            <ice:commandLink actionListener="#{singlePlan.vote}" onclick="if(! deferUntilLogin()) return false; "
                    styleClass="indexVoteForPlan #{singlePlan.votedOn ? 'en userVote' : 'dis'} ">
            </ice:commandLink>
        </ice:column>
    </ice:dataTable>
        <div class="underLinks">
            <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'}"><strong>see all</strong></a>
        </div>
            
            </div>
            </ice:form>
            </ice:panelSeries>
            
        </ui:define>
    </ui:composition>
</f:view>