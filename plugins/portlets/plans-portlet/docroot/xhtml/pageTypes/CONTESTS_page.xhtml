<?xml version="1.0"?>
<!--
  ~ Copyright (c) 2010. M.I.T. All Rights Reserved
  ~ Licensed under the MIT license. Please see http://www.opensource.org/licenses/mit-license.php
  ~ or the license.txt file included in this distribution for the full text of the license.
  -->

<f:view
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:collab="http://climatecollaboratorium.org/facelets"
        xmlns:sharedcollab="http://climatecollaboratorium.org/components">

    <ui:composition template="../templates/singlePageWithBreadcrumb.xhtml">
        <ui:define name="plans_content">

            <ice:panelSeries value="#{contests.contests}" var="singleContest">
                <ice:form>
                    <ice:panelGroup styleClass="categoryHeader" rendered="#{not singleContest.editor.editing}">
                        <h2>
                            <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'}">
                                <ice:outputText styleClass="categoryName" value="#{singleContest.name}"/>
                            </a>
                        </h2>
                        <ice:commandButton styleClass="editCategoryButton" value="Edit"
                                           action="#{singleContest.editor.edit}"
                                           rendered="#{not singleContest.editor.editing and permissions.canAdminAll}"/>
                    </ice:panelGroup>
                    <ice:panelGroup styleClass="categoryHeader" rendered="#{singleContest.editor.editing}">
                        <ice:outputLabel for="name">Name</ice:outputLabel>

                        <h2><ice:inputText id="name" styleClass="categoryName" value="#{singleContest.editor.name}"/>
                        </h2>
                    </ice:panelGroup>
                    <ice:panelGroup styleClass="categoryShortName" rendered="#{singleContest.editor.editing}">
                        <ice:outputLabel for="shortName">Short name</ice:outputLabel>
                        <ice:inputText id="shortName" value="#{singleContest.editor.shortName}"/>
                    </ice:panelGroup>
                    <table class="single-contest-layout">
                        <tr>
                            <td class="description">


                                <ice:panelGroup styleClass="categoryDescription"
                                                rendered="#{not singleContest.editor.editing}">
                                    <ice:outputLabel for="description">Description</ice:outputLabel>
                                    <ice:outputText id="description" value="#{singleContest.description}"
                                                    escape="false"/>
                                </ice:panelGroup>
                                <ice:panelGroup styleClass="categoryDescription"
                                                rendered="#{singleContest.editor.editing}">
                                    <ice:inputTextarea value="#{singleContest.editor.description}"/>
                                </ice:panelGroup>
                                <ice:panelGrid columns="2" styleClass="editCategory buttonPanel"
                                               rendered="#{singleContest.editor.editing}">
                                    <ice:commandButton value="Save" action="#{singleContest.editor.save}"/>
                                    <ice:commandButton value="Cancel" action="#{singleContest.editor.cancel}"/>
                                </ice:panelGrid>

                            </td>
                            <td class="contestNavItems">

                                <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'},subview:issues"
                                   class="#{contest.subView == 'ISSUES' ? 'active' : ''}">
                                    <div class="prominantButton">Debate the issues!</div>
                                </a>

                                <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'},subview:model"
                                   class="#{contest.subView == 'MODEL' ? 'active' : ''}">
                                    <div class="prominantButton">Run the model!</div>
                                </a>
                            </td>
                        </tr>
                    </table>
                </ice:form>


                <ice:form>

                    <div class="contestContent">
                        <ice:dataTable value="#{singleContest.plansIndex.plans}" styleClass="plansTable"
                                       rowClasses="odd,even"
                                       var="singlePlan" sortColumn="#{singleContest.plansIndex.sortColumn}"
                                       sortAscending="#{singleContest.plansIndex.sortAscending}" id="plansIndex"
                                       rows="#{preferences.maxProposalsPerContest[singleContest.contest.contestPK]}"
                                       headerClass="#{singleContest.plansIndex.columns}">
                            <ice:columns value="#{singleContest.plansIndex.columns}" var="column">
                                <f:facet name="header">
                                    <div>
                                        <div class="popup-info-box hidden"
                                             id="info-popup-#{column}">#{column.description}</div>
                                        <div class="clear"></div>
                                        <ice:commandSortHeader styleClass="column-hover" columnName="#{column}">
                                            <ice:outputText id="column-#{column}" value="#{column.name}"
                                                            escape="false"/>
                                        </ice:commandSortHeader>
                                    </div>
                                </f:facet>
                                <ice:outputLink rendered="#{column == 'NAME'}"
                                                value="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'},subview:proposals,planId:#{singlePlan.planId}"
                                                onclick="Collab.nav.navigate('plans', {contests: '#{singleContest.contestActive ? 'active' : 'past'}', subview: 'proposals', planId: #{singlePlan.planId}}, true); return false;">
                                    <ice:outputText value="#{singlePlan.columnValues[column]}" styleClass="#{column}"/>
                                </ice:outputLink>
                                <f:subview rendered="#{column == 'POSITIONS' and !singlePlan.hasPositions}">
                                    N/A
                                </f:subview>
                                <f:subview rendered="#{column == 'POSITIONS' and singlePlan.hasPositions}">
                                    <a href="javascript:;" class="showPositions"
                                       onclick="showPositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}');return;"/>

                                    <div class="hidden" id="plan_positions_#{singlePlan.planId}">
                                        <div class="positionsDialog">
                                            <div class="positionsDialog_top">
                                                <div class="title"><h2>Positions for #{singlePlan.planName}</h2></div>
                                            </div>
                                            <div class="positionsDialog_bg">
                                                <div class="scrollBox">
                                                    <ice:panelSeries value="#{singlePlan.positions}" var="question">
                                                        <div class="assumption">
                                                            <h3 class="question">#{question.debateAnchor}</h3>
                                                            <h4 class="position">#{question.selectedPosition.itemAnchor}</h4>
                                                        </div>
                                                    </ice:panelSeries>
                                                </div>
                                            </div>
                                            <div class="positionsDialog_bottom">
                                                <a href="javascript:;"
                                                   onclick="hidePositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}')">Close</a>
                                            </div>
                                        </div>
                                    </div>
                                </f:subview>
                                <f:subview
                                        rendered="#{column == 'SEEKING_ASSISTANCE' and singlePlan.columnValues[column] == 'true'}">
                                    <img src="/collaboratorium-theme/images/hand_icon.png"/>
                                </f:subview>
                                <f:subview rendered="#{column == 'IS_PLAN_OPEN'}">
                                    <ice:outputText value="Anyone"
                                                    rendered="#{singlePlan.columnValues[column] == 'true'}"/>
                                    <ice:outputText value="Team only"
                                                    rendered="#{singlePlan.columnValues[column] != 'true'}"/>
                                </f:subview>
                                <ice:outputText value="#{singlePlan.columnValues[column]}"
                                                rendered="#{column != 'NAME' and column != 'POSITIONS' and column != 'SEEKING_ASSISTANCE' and column != 'IS_PLAN_OPEN'}"
                                                escape="false"/>
                            </ice:columns>
                            <ice:column rendered="#{singleContest.plansIndex.contestPhase.canVote}">
                                <f:facet name="header">
                                    <div class="voteForPlan"><span>Vote for Plan</span></div>
                                </f:facet>
                                <ice:commandLink actionListener="#{singlePlan.vote}"
                                                 onclick="if(! deferUntilLogin()) return false; "
                                                 styleClass="indexVoteForPlan #{singlePlan.votedOn ? 'en userVote' : 'dis'} ">
                                </ice:commandLink>
                            </ice:column>
                        </ice:dataTable>

                        <div class="underLinks">
                            <a href="#plans=contests:#{singleContest.contestActive ? 'active' : 'past'}"><strong>see all</strong></a>
                        </div>

                    </div>
                </ice:form>
            </ice:panelSeries>

        </ui:define>
    </ui:composition>
</f:view>