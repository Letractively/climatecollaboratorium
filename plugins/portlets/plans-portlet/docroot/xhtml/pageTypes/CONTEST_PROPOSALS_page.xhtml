<?xml version="1.0"?>
<f:view
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:collab="http://climatecollaboratorium.org/facelets">
        
    <ui:composition template="../templates/contestPageTemplate.xhtml">
        <ui:define name="contest_content">
            <ice:form>
                <ui:include src="../createPlan.xhtml">
                    <ui:param value="#{navigation.createPlanBean}" name="createPlanBean"/>
                </ui:include>
            </ice:form>
            <div class="contestPhaseInfo">
                <div class="details">
                    <f:subview rendered="#{plansIndex.contestPhase.status != 'FINISHED'}">
                        <h3>#{plansIndex.contestPhase.description} 
                            (#{plansIndex.plansCount} proposals #{plansIndex.contestPhase.status == 'OPEN_FOR_SUBMISSION' ? 'thus far' : ''})
                        </h3>
                        <h4>Closes &amp;nbsp;
                            <ice:outputText value="#{plansIndex.contestPhase.endDate}">
                                <f:convertDateTime pattern="MMMMM d, yyyy" />
                            </ice:outputText>
                        </h4>
                    </f:subview>
                    
                    <f:subview rendered="#{plansIndex.contestPhase.status == 'FINISHED'}">
                        <h3>Contest completed  &amp;nbsp;
                            <ice:outputText value="#{plansIndex.contestPhase.endDate}">
                                <f:convertDateTime pattern="MMMMM d, yyyy" />
                            </ice:outputText>
                        </h3>
                    </f:subview>
                </div>
                <f:subview rendered="#{plansIndex.contestPhase.status == 'OPEN_FOR_SUBMISSION'}">
                    <ice:form>
                        <ice:commandButton onclick="if(!deferUntilLogin()) return false; Collab.nav.block();"
                                styleClass="prominantButton createNewPlanButton"
                                actionListener="#{navigation.createPlanBean.createPlan}"
                                value="Begin a new proposal"/>
                    </ice:form>
                </f:subview>
                        <div class="clear"></div>
            </div>
            
        
        <div class="proposalsListNav">
            <f:subview rendered="#{not contests.currentPhase.firstPhase}">
                <a href="#plans=contests:#{contests.contest.contestActive ? 'active' : 'past'},subview:proposals,viewProposals:active"
                    class="#{plansIndex.showPreviousProposals ? '' : 'active'}" >
                    <ice:outputText value="Active Proposals" rendered="#{plansIndex.contestPhase.status != 'FINISHED'}" />
                    <ice:outputText value="Final Proposals" rendered="#{plansIndex.contestPhase.status == 'FINISHED'}" />
                </a>
                <a href="#plans=contests:#{contests.contest.contestActive ? 'active' : 'past'},subview:proposals,viewProposals:previous" 
                    class="#{plansIndex.showPreviousProposals ? 'active' : ''}">
                    <ice:outputText value="Previous Proposals" rendered="#{plansIndex.contestPhase.status != 'FINISHED'}" />
                    <ice:outputText value="Other Proposals" rendered="#{plansIndex.contestPhase.status == 'FINISHED'}" />
                </a>                
            </f:subview>
                <div class="filters">
                    <ice:form>
                        <ice:selectBooleanCheckbox onclick="if(! deferUntilLogin()) return false; " value="#{plansIndex.showProposalsThatUserOwns}" partialSubmit="true"> Proposals that I own</ice:selectBooleanCheckbox>
                        <ice:selectBooleanCheckbox onclick="if(! deferUntilLogin()) return false; " value="#{plansIndex.showProposalsThatUserSupports}" partialSubmit="true"> Proposals that I support</ice:selectBooleanCheckbox>
                    </ice:form>
                </div>
                
                
                <div class="clear"></div>
        
        </div>
            <ice:form>
                <ice:dataTable value="#{plansIndex.plans}" styleClass="plansTable" rowClasses="odd,even"
            var="singlePlan" sortColumn="#{plansIndex.sortColumn}"
            sortAscending="#{plansIndex.sortAscending}" id="plansIndex"
            rows="#{plansIndex.pageSize}" headerClass="#{plansIndex.columns}">
        <ice:columns value="#{plansIndex.columns}" var="column">
            <f:facet name="header">
                <div>
                    <div class="popup-info-box hidden" id="info-popup-#{column}">#{column.description}</div>
                    <div class="clear"></div>
                    <ice:commandSortHeader styleClass="column-hover" columnName="#{column}">
                        <ice:outputText id="column-#{column}" value="#{column.name}" escape="false"/>
                    </ice:commandSortHeader>
                </div>
            </f:facet>
            <ice:outputLink rendered="#{column == 'NAME'}"
                    value="#plans=contests:#{contests.contest.contestActive ? 'active' : 'past'},subview:proposals,planId:#{singlePlan.planId}">
                <ice:outputText value="#{singlePlan.columnValues[column]}" styleClass="#{column}"/>
            </ice:outputLink>
            <f:subview rendered="#{column == 'POSITIONS' and !singlePlan.hasPositions}">
                N/A
            </f:subview>
            <f:subview rendered="#{column == 'POSITIONS' and singlePlan.hasPositions}">
                <a href="javascript:;" class="showPositions"
                        onclick="showPositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}');return;"/>
                <div class="hidden" id="plan_positions_#{singlePlan.planId}">
                    <div class="positionsDialog">
                        <div class="positionsDialog_top">
                            <div class="title"><h2>Positions for #{singlePlan.planName}</h2></div>
                        </div>
                        <div class="positionsDialog_bg">
                            <div class="scrollBox">
                                <ice:panelSeries value="#{singlePlan.positions}" var="question">
                                    <div class="assumption">
                                        <h3 class="question">#{question.debateAnchor}</h3>
                                        <h4 class="position">#{question.selectedPosition.itemAnchor}</h4>
                                    </div>
                                </ice:panelSeries>
                            </div>
                        </div>
                        <div class="positionsDialog_bottom">
                            <a href="javascript:;"
                                    onclick="hidePositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}')">Close</a>
                        </div>
                    </div>
                </div>
            </f:subview>
            <f:subview rendered="#{column == 'SEEKING_ASSISTANCE' and singlePlan.columnValues[column] == 'true'}">
                <img src="/collaboratorium-theme/images/hand_icon.png" />
            </f:subview>
            <f:subview rendered="#{column == 'IS_PLAN_OPEN'}">
                <ice:outputText value="Anyone" rendered="#{singlePlan.columnValues[column] == 'true'}" />
                <ice:outputText value="Team only" rendered="#{singlePlan.columnValues[column] != 'true'}" />
            </f:subview>
            <ice:outputText value="#{singlePlan.columnValues[column]}"
                    rendered="#{column != 'NAME' and column != 'POSITIONS' and column != 'SEEKING_ASSISTANCE' and column != 'IS_PLAN_OPEN'}" escape="false"/>
        </ice:columns>
        <ice:column rendered="#{plansIndex.contestPhase.canVote}">
            <f:facet name="header">
                <div class="voteForPlan"><span>Vote for Plan</span></div>
            </f:facet>
            <ice:commandLink actionListener="#{singlePlan.vote}" onclick="if(! deferUntilLogin()) return false; "
                    styleClass="indexVoteForPlan #{singlePlan.votedOn ? 'en userVote' : 'dis'} ">
            </ice:commandLink>
        </ice:column>
    </ice:dataTable>
    
    <ice:panelGroup styleClass="hidden">
                    #{plansIndexBean.plans}
                    <script language="javascript">
                        initializeColumnsInfo();
                        makeNANotesVisible();
                    </script>
                </ice:panelGroup>

                <div class="pageBottom">

                    <div class="pageNum">


                        <ice:dataPaginator id="dataScroll_2" for="plansIndex" rowsCountVar="rowsCount"
                                           displayedRowsCountVar="displayedRowsCountVar"
                                           firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
                                           pageCountVar="pageCount" pageIndexVar="pageIndex"
                                           styleClass="paginatorInfo">
                            <ice:outputFormat
                                    value="Displaying &lt;strong&gt;{0}&lt;/strong&gt; - &lt;strong&gt;{1}&lt;/strong&gt; of &lt;strong&gt;{2}&lt;/strong&gt; Plans"
                                    styleClass="paginatorInfo" escape="false">
                                <f:param value="#{firstRowIndex}"/>
                                <f:param value="#{lastRowIndex}"/>
                                <f:param value="#{rowsCount}"/>
                            </ice:outputFormat>
                        </ice:dataPaginator>

                        <ice:dataPaginator id="dataScroll_1" rendered="true" for="plansIndex" paginator="true"
                                           paginatorMaxPages="1" styleClass="paginator">
                            <f:facet name="first">
                                <ice:panelGroup>
                                    <ice:outputText value="First Page" styleClass="first"/>
                                </ice:panelGroup>
                            </f:facet>
                            <f:facet name="last">
                                <ice:panelGroup>
                                    <ice:outputText value="Last Page" styleClass="last"/>
                                </ice:panelGroup>
                            </f:facet>
                            <f:facet name="previous">
                                <ice:panelGroup>
                                    <ice:outputText value="Previous" styleClass="prev"/>
                                </ice:panelGroup>
                            </f:facet>
                            <f:facet name="next">
                                <ice:panelGroup>
                                    <ice:outputText value="Next" styleClass="next"/>
                                </ice:panelGroup>
                            </f:facet>
                        </ice:dataPaginator>

                        <div class="clear"></div>
                    </div>
                    <div class="clear"></div>
                </div>
    
            
            </ice:form>
            
            
            
        </ui:define>
    </ui:composition>
</f:view>
