<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:collab="http://climatecollaboratorium.org/components">

    <ice:panelGroup styleClass="portlet">
        <div class="container">
            <div class="container_top">
                <div class="topActions">
                    <ice:form>
                        <ui:include src="./createPlan.xhtml">
                            <ui:param value="#{plan.createplan}" name="createplan"/>
                        </ui:include>

                        <ice:commandLink onclick="if(!deferUntilLogin()) return false;"
                                         actionListener="#{plan.createplan.createPlan}">create new plan based on this</ice:commandLink> |&amp;nbsp;
                        <ice:commandLink value="subscribe" onclickactionListener="#{plan.plan.subscribe}"/>
                    </ice:form>
                </div>
                <ice:form>
                    <div class="title">
                        <div class="icon">
                            <f:subview rendered="#{not plan.editingName}">
                                <h2><ice:outputText value="#{plan.plan.name}"/></h2>

                                <div class="actions textual">
                                    <ice:commandLink value="rename" actionListener="#{plan.editName}"
                                                     rendered="#{permissions.canEdit}"/>
                                </div>

                            </f:subview>
                            <f:subview rendered="#{plan.editingName}">
                            
                                <ice:panelGroup styleClass="hidden ">
                                    <script type="text/javascript">
                                        Collab.nav.addEditorDirtyValidationCallback(checkIfPlanNameDirty);
                                    </script>
                                </ice:panelGroup>

                                <ice:inputText value="#{plan.plan.name}" id="renamePlanName" styleClass='planNameInput' onchange="jQuery(this).addClass('valueChanged');">
                                    <f:validator validatorId="planNameValidator"/>
                                </ice:inputText>

                                <div class="actions">
                                    <ice:commandLink actionListener="#{plan.plan.saveName}" styleClass="checkBtn"/>&amp;nbsp;&amp;nbsp;
                                    <ice:commandLink actionListener="#{plan.editName}" styleClass="cancelBtn"
                                                     immediate="true"/>
                                </div>
                                <ice:message for="renamePlanName" styleClass="renamePlanMessage"/>
                            </f:subview>

                            <div class="clear"></div>
                        </div>

                        <ice:outputConnectionStatus/>
                        <f:subview rendered="#{not plan.editingName}">
                            <div class="planVotes">
                                #{plan.plan.votes} (#{plan.votesPercent}%) votes.&amp;nbsp;
                                <ice:commandLink value="Vote for this plan" actionListener="#{plan.plan.vote}"
                                                 rendered="#{not plan.plan.votedOn}"/>
                                <ice:commandLink value="Retract your vote for this plan"
                                                 actionListener="#{plan.plan.unvote}"
                                                 rendered="#{plan.plan.votedOn}"/>
                            </div>
                        </f:subview>
                    </div>
                </ice:form>
            </div>
            <div class="container_middle">
                <div class="content">
                    <ice:form>
                        <collab:helpMessage messageId="planDetailHelp" styleClass="planHelp"
                                            hideThisMessage="Hide this message">
                            Click through tabs to create a plan:
                                (1) write&#160;<a href="javascript:" onclick="Collab.nav.navigateAddParams('plans', {tab: 'description'}); return;">Description</a>,
                                (2) choose&#160;<a href="javascript:" onclick="Collab.nav.navigateAddParams('plans', {tab: 'positions'}); return;">Positions</a>,
                                (3) select&#160;<a href="javascript:" onclick="Collab.nav.navigateAddParams('plans', {tab: 'models'}); return;">Model</a>,
                                (4) decide on&#160;<a href="javascript:" onclick="Collab.nav.navigateAddParams('plans', {tab: 'actionsimpacts'}); return;">Actions and run model to view Impacts</a>,
                                (5) submit plan at&#160;<a href="javascript:" onclick="Collab.nav.navigateAddParams('plans', {tab: 'admin'}); return;">Admin</a>.

                        </collab:helpMessage>
                        <collab:helpMessageTrigger
                                messageId="planDetailHelp">+show help</collab:helpMessageTrigger>
                        <ice:panelTabSet styleClass="mainTabs"
                                         columnClasses="admin,description,assumptions,models,actionsImpacts,discussion,team"
                                         selectedIndex="#{plan.selectedTab}">
                                         
                            <ice:panelTab label="Admin"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'admin'}); return;" 
                                          rendered="#{permissions.canAdmin}">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/admin.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Actions &amp; Impacts" styleClass="actionsImpacts"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'actionsimpacts'}); return;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/actionsImpacts.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Positions"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'positions'}); return;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/assumptions.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Description"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'description'}); return;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/description.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="Discussion"
                                          onclick="Collab.nav.navigateAddParamsMulti({'plans': {tab: 'discussion'}, 'discussion': {}}); return;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/discussion.xhtml"/>
                                </f:subview>
                            </ice:panelTab>

                         <!--   <ice:panelTab label="Models"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'models'}); return;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/models.xhtml"/>
                                </f:subview>
                            </ice:panelTab> -->


                            <ice:panelTab label="Team"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'team'}); return;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/team.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                        </ice:panelTabSet>
                    </ice:form>
                </div>
            </div>
            <!-- .container_middle -->

            <div class="container_bottom"></div>
        </div>
        <!-- .container -->
    </ice:panelGroup>
</f:view>
